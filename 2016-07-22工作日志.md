# 2016-07-22工作日志

标签（空格分隔）： 2016年工作日志

---

今天礼拜五，醒来的时候已经七点多了，十分自责，原因不是因为昨天学习的太累，而是看视频看到凌晨。

一天的作业和总结：

### 置顶帖子优化缓存

<font color="FF2D2D">问题描述</font>：原先置顶的帖子是在项目启动的时候，就全部查询出来，不对外提供单独查询接口，而是通过一个定时任务三小时重新查询一次，这就造成后台运营人员将帖子置顶或取消置顶后，前端APP不能立即显示置顶帖子的最新状态。

<font color="FF2D2D">解决思路</font>：启动的时候不需要加载全部的置顶帖子，而是对外提供查询置顶帖子的接口，但不是每次发起请求都去查询数据库，而是在第一次请求的时候加载数据到缓存中，然后再运营人员修改置顶帖子的时候，修改缓存中的数据，bingo。

<font color="FF2D2D">解决过程中问题</font>：用的缓存是Memcached，公司又对其进行了封装，不过封装的很烂，什么日志都不打，报错也就是返回false，对使用的开发人员十分不友好；今天在加缓存的时候，总是返回false，百思不得其解，问了别人才知道是因为<b>Bean没有序列化</b>，看了眼项目中的业务Bean发现竟然没有一个<b>公共的基类</b>用于统一实现序列化接口、封装公用字段（id等）、重写toString()，真的很low。

### APP端获取视频、语音文件优化

<font color="FF2D2D">问题描述</font>：现在APP端获取视频、语音文件列表是一次性全部加载出来，用户点开之后APP需要花很长时间来渲染，用户体验很差，而且服务器的压力也会增大。

<font color="FF2D2D">解决思路</font>：后端提供分页查询的接口，对前端发起的请求返回分页数据。

<font color="FF2D2D">解决过程中问题</font>：后台分页查询数据的接口是改好了，但是前端发起的请求是从APP发起的，我这边没有APP端的代码，那怎么模拟真实的请求呢？这时候就需要charles出马了，charles篡改请求方式的步骤如下：

 1. 首先抓取到请求，右键选中Breakpoints，对请求设置断点；

 2. 右键选中Repeat，就会重发请求，这时候charles就会将该请求拦截住，此时就可以对Request进行编辑了（追加一些请求参数），然后点击excute；

 3. 执行请求后返回的响应，charles也会进行拦截，修改完之后再次点击excute就进行真正的响应了。
  
