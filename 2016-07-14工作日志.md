# 2016-07-14工作日志

标签（空格分隔）： 2016年工作日志

---

今天花了很多时间研究阿里云OSS，并成功的接入了，可谓收获丰收~

## 阿里云OSS概念

阿里云 OSS（Object-Storage-Service）提供基于网络的数据存取服务。使用OSS，就可以通过网络随时存储和调用包括文本、图片、音频、和视频等在内的各种<font color="FF2D2D">结构化或非结构化数据</font>文件。

 - 结构化数据：即行数据，存储在数据库里，可以用<font color="FF2D2D">二维表结构</font>来逻辑表达实现的数据；

 - 非结构化数据：不方便用数据库二维逻辑表来表现的数据即称为非结构化数据，包括所有格式的办公文档、文本、图像和音频/视频信息等等；

 - 半结构化数据：介于完全结构化数据（如关系型数据库、面向对象数据库中的数据）和完全无结构的数据（如声音、图像文件等）之间的数据，HTML文档就属于半结构化数据；

## 阿里云OSS中重要的知识点

### 存储空间（Bucket）

存储空间是用于存储对象（Object）的容器，所有的对象都必须隶属于某个存储空间。可以设置和修改存储空间属性用来控制地域、访问权限、生命周期等，这些属性设置直接作用于该存储空间内所有对象，因此可以通过灵活创建不同的存储空间来完成不同的管理功能。

同一个存储空间内部的空间是扁平的，没有文件系统的目录等概念，所有的对象都是直接隶属于其对应的存储空间。

 - 每个用户可以拥有多个存储空间。

 - 存储空间的名称在 OSS 范围内必须是全局唯一的，一旦创建之后无法修改名称。

 - 存储空间内部的对象数目没有限制。

 - 存储空间命名规范

> Bucket的命名规范：
 1. 只能包括小写字母，数字和短横线（-）
 2. 必须以小写字母或者数字开头
 3. 长度必须在3-63字节之间
 
### 对象/文件（Object）

对象是 OSS 存储数据的基本单元，也被称为 OSS 的文件。对象由元信息（Object Meta），用户数据（Data）和文件名（Key）组成。对象由存储空间内部唯一的Key来标示。对象元信息是一个键值对，表示了对象的一些属性，比如最后修改时间、大小等信息，同时用户也可以在元信息中存储一些自定义的信息中。

根据不同的上传方式，对象的大小限制是不一样的。分片上传最大支持48.8TB的对象大小，其他的上传方式最大支持 5 GB。

对象的生命周期是从上传成功到被删除为止，在整个生命周期内，对象信息不可变更。<font color="FF2D2D">重复上传同名的对象会覆盖之前的对象</font>，因此，OSS不支持类似文件系统的修改部分内容等操作。

OSS 提供了追加上传功能，用户可以使用该功能不断地在Object尾部追加写入数据。

> 对象命名规范
 1. 使用UTF-8编码
 2. 长度必须在1-1023字节之间
 3. 不能以“/”或者“\”字符开头
 
### Region（区域）

Region 表示 OSS 的数据中心所在的区域，物理位置。用户可以根据费用、请求来源等综合选择数据存储的Region。一般来说，距离用户更近的Region访问速度更快。详细请查看<a href="https://help.aliyun.com/document_detail/31834.html?spm=5176.doc31827.2.3.x77U05">OSS已经开通的Region</a>。

Region是在创建Bucket的时候指定的，一旦指定之后就不允许更改，该Bucket下所有的Object都存储在对应的数据中心，目前不支持Object级别的Region设置。

### Endpoint（访问域名）

Endpoint表示OSS对外服务的访问域名。OSS以HTTP-REST-API的形式对外提供服务，当访问不同的Region的时候，需要不同的域名。通过内网和外网访问同一个Region所需要的Endpoint也是不同的。例如杭州Region的外网Endpoint就是oss-cn-hangzhou.aliyuncs.com，内网Endpoint是oss-cn-hangzhou-internal.aliyuncs.com。更具体的内容可以参考<a href="https://help.aliyun.com/document_detail/31834.html?spm=5176.doc31827.2.4.x77U05">各个Region对应的Endpoint</a>。

### AccessKey（访问密钥）

AccessKey，简称AK，指的是访问身份验证中用到的AccessKeyId和AccessKeySecret。 OSS通过使用AccessKeyId和AccessKeySecret<font color="FF2D2D">对称加密</font>的方法来验证某个请求的发送者身份。AccessKeyId用于标示用户，AccessKeySecret是用户用于加密签名字符串和OSS用来验证签名字符串的密钥，其中AccessKeySecret必须保密。对于OSS来说，AccessKey的来源有：

Bucket的拥有者申请的AccessKey。
被Bucket的拥有者通过RAM授权第三方请求者的AccessKey。
被Bucket的拥有者通过STS授权第三方请求者的AccessKey。
更多AccessKey介绍见<a href="https://help.aliyun.com/document_detail/31867.html?spm=5176.doc31827.2.5.x77U05">访问控制</a>。

### 强一致性

Object操作在OSS上具有<font color="FF2D2D">原子性</font>，操作要么成功要么失败，不会存在有中间状态的Object。OSS保证用户一旦上传完成之后读到的Object是完整的，OSS不会返回给用户一个只上传成功了部分的Object。

Object操作在OSS上同样具有强一致性，用户一旦收到了一个上传（PUT）成功的响应，该上传的Object就已经立即可读，并且数据的三份副本已经写成功。不存在一种上传的中间状态，即read-after-write却无法读取到数据。对于删除操作也是一样的，用户删除指定的Object成功之后，该Object立即变为不存在。

强一致性方便了用户架构设计，可以像使用传统存储设备一样的逻辑使用OSS，修改立即可见，无需考虑最终一致性带来的各种问题。

### OSS与文件系统的对比

OSS是一个分布式的对象存储服务，提供的是一个Key-Value对形式的对象存储服务。用户可以根据<font color="FF2D2D">Object的名称（Key）</font>唯一的获取该Object的内容。虽然用户可以使用类似test1/test.jpg的名字，但是这并不表示用户的Object是保存在test1目录下面的。对于OSS来说，test1/test.jpg仅仅只是一个字符串，和a.jpg这种并没有本质的区别。因此不同名称的Object之间的访问消耗的资源是类似的。

文件系统是一种典型的树状的索引结构，一个名为test1/test.jpg的文件，访问过程需要先访问到test1这个目录，然后再在该目录下查找名为test.jpg的文件。因此文件系统可以很轻易的支持文件夹的操作，比如重命名目录、删除目录、移动目录等，因为这些操作仅仅只是对了目录节点的操作。这种组织结构也决定了文件系统访问越深的目录消耗的资源也越大，操作拥有很多文件的目录也会非常慢。

对于OSS来说，可以通过一些操作来模拟类似的功能，但是代价非常昂贵。比如重命名目录，希望将test1目录重命名成test2，那么OSS的实际操作是将所有以test1/开头的Object都重新复制成以test2/开头的Object，这是一个非常消耗资源的操作。因此在使用OSS的时候要尽量避免类似的操作。

OSS保存的Object是不支持修改的（追加写Object需要调用特定的接口，生成的Object也和正常上传的Object类型上有差别）。用户哪怕是仅仅需要修改一个字节也需要重新上传整个Object。而文件系统的文件是支持修改，比如修改指定偏移位置的内容、截断文件尾部等，这些特点也使得文件系统拥有广泛的适用性。但另外一方面，OSS能支持海量的用户并发访问，而文件系统会受限于单个设备的性能。

因此，将OSS映射为文件系统是非常低效的，也是不建议的做法。如果一定要挂载成文件系统的话，也尽量只做写新文件、删除文件、读取文件这几种操作。使用OSS应该充分发挥其优点，即海量数据处理能力，优先用来存储海量的非结构化数据，比如图片、视频、文档等。